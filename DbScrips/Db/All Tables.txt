CREATE TABLE Users (
    UserID INT IDENTITY PRIMARY KEY,
    Email NVARCHAR(255) UNIQUE NOT NULL,
    PasswordHash NVARCHAR(255) NOT NULL,
    ProfileImage NVARCHAR(255),
    Bio NVARCHAR(MAX),
    Role NVARCHAR(20) CHECK (Role IN ('Learner', 'Instructor', 'Admin'))
);

CREATE TABLE Categories (
    CategoryID INT IDENTITY PRIMARY KEY,
    Name NVARCHAR(100) UNIQUE NOT NULL,
    Description NVARCHAR(255)
);

CREATE TABLE Courses (
    CourseID INT IDENTITY PRIMARY KEY,
    Title NVARCHAR(255) NOT NULL,
    Description NVARCHAR(MAX),
    CategoryID INT FOREIGN KEY REFERENCES Categories(CategoryID),
    InstructorID INT FOREIGN KEY REFERENCES Users(UserID),
    Level NVARCHAR(20) CHECK (Level IN ('Beginner', 'Intermediate', 'Advanced')),
    Price DECIMAL(10,2),
    Discount DECIMAL(10,2) NULL,
    TotalDuration INT DEFAULT 0,
    CreatedAt DATETIME DEFAULT GETDATE()
);

CREATE TABLE Lessons (
    LessonID INT IDENTITY PRIMARY KEY,
    CourseID INT FOREIGN KEY REFERENCES Courses(CourseID) ON DELETE CASCADE,
    Title NVARCHAR(255) NOT NULL,
    VideoURL NVARCHAR(255) NOT NULL,
    Duration INT NOT NULL
);

CREATE TABLE Enrollments (
    EnrollmentID INT IDENTITY PRIMARY KEY,
    UserID INT FOREIGN KEY REFERENCES Users(UserID) ON DELETE CASCADE,
    CourseID INT FOREIGN KEY REFERENCES Courses(CourseID) ON DELETE CASCADE,
    EnrollmentDate DATETIME DEFAULT GETDATE(),
    Progress INT CHECK (Progress BETWEEN 0 AND 100) DEFAULT 0
);

CREATE TABLE Reviews (
    ReviewID INT IDENTITY PRIMARY KEY,
    UserID INT FOREIGN KEY REFERENCES Users(UserID) ON DELETE CASCADE,
    CourseID INT FOREIGN KEY REFERENCES Courses(CourseID) ON DELETE CASCADE,
    Rating INT CHECK (Rating BETWEEN 1 AND 5) NOT NULL,
    Comment NVARCHAR(MAX),
    CreatedAt DATETIME DEFAULT GETDATE()
);

CREATE TABLE Bookmarks (
    UserID INT FOREIGN KEY REFERENCES Users(UserID) ON DELETE CASCADE,
    CourseID INT FOREIGN KEY REFERENCES Courses(CourseID) ON DELETE CASCADE,
    PRIMARY KEY (UserID, CourseID)
);

CREATE TABLE Reports (
    ReportID INT IDENTITY PRIMARY KEY,
    GeneratedAt DATETIME DEFAULT GETDATE(),
    ReportType NVARCHAR(50),
    DataJSON NVARCHAR(MAX)
);
